@model IEnumerable<NotePlot.Models.ParameterRelation>

@{
    string atr_disabled = "disabled";
}
@*<button id="np_relation_add"  href="/Parameter/ParameterListDialog" np_dialog_title = "Параметры" np_dialog_width ="800px">Добавить параметр</button>
    <button id="np_relation_del">Удалить параметр</button>*@
@if (@ViewBag.LoginID != 0)
{
    <div class="np-tool-bar">
        <a id="np_relation_add" href="/Parameter/ParameterListDialog" np_dialog_title="Параметры" np_dialog_width="800px"><button class='ui-button ui-corner-all'>Добавить параметр</button></a>
        <a id="np_relation_del" href=""><button class='ui-button ui-corner-all np-btn-selected-row' @atr_disabled>Удалить параметр</button></a>
    </div>
}
<table id="parameterRelations" class="table" width="100%">
    <thead>
        <tr>
            <th hidden>ParameterID</th>
            <th hidden>MathOperationID</th>
            <th>Параметр</th>
            <th>Действие</th>
        </tr>
    </thead>
    <tbody>
        @foreach (var item in Model)
        {
            <tr>
                <td hidden><input type="text" id="ParameterID" name="ParameterID" value="@item.ParameterID" /></td>
                <td hidden><input type="text" id="MathOperationID" name="MathOperationID" value="@item.MathOperationID"/></td>
                <td>@item.ParameterShortName</td>
                <td>@item.MathOperationFullName</td>
            </tr>
        }
    </tbody>
</table>
<script type="text/javascript">
    $("#parameterRelations").DataTable({
        "paging": false,
        "ordering": false,
        "oLanguage": { "sZeroRecords": "", "sEmptyTable": "" }, //убрать сообщение о пусто таблице
        "sDom": ''  // поиск
    });
    $('#parameterRelations').on('page.dt order.dt search.dt', function () {
        $('#parameterRelations tbody tr.selected').removeClass('selected');
    });

    //$('#parameterGroups tbody tr').on('click', function () {
    $('#parameterRelations tbody').on('click', 'tr', function () {
        if ($(this).hasClass('selected')) {
            $(this).removeClass('selected');
            disableButtons();
        }
        else {
            $('#parameterRelations tbody tr.selected').removeClass('selected');
            $(this).addClass('selected');
            enableButtons();
        }
    });

    $('#np_relation_add').on('click', function (e) {
        e.preventDefault();
        OpenDialog(this);
    });

    $('#np_relation_del').on('click', function (e) {
        e.preventDefault();
        //$('#parameterRelations tbody tr.selected').remove();
        var r = $('#parameterRelations tbody tr.selected');
        if (r.length > 0) {
            r.remove();
            disableButtons();
            if (refreshPage) {
                refreshPage();
            }
        }
    });

    //TODO: вынести в файл
    function enableButtons() {
        $('.np-btn-selected-row').each(function () {
            if ($(this).attr('disabled')) {
                $(this).removeAttr('disabled');
            }
        });
    }

    function disableButtons() {
        $('.np-btn-selected-row').each(function () {
            if (!$(this).attr('disabled')) {
                $(this).attr('disabled', 'disabled');
            }
        });
    }
</script>

