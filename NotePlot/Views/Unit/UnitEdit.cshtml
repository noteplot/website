@model NotePlot.Models.Unit

@{
    string atr_disabled = "disabled";
}

<form id="unit" method="POST" action=@ViewBag.Action>
    @Html.AntiForgeryToken()
    <input type="hidden" id="UnitID" name="UnitID" value="@Model.UnitID"/>
    <input type="hidden" id="UnitGroupID" name="UnitGroupID" value="@Model.UnitGroupID" data-target="UnitGroupID" data-target-value=""/>
    <div class="input-prepend">
        <label for="UnitShortName" class="np_label">Краткое наименование</label>
        <input type="text" id="UnitShortName" name="UnitShortName" placeholder="Краткое наименование" value="@Model.UnitShortName" @if (Model.LoginID == 0) { @atr_disabled } />
    </div>
    <div class="input-prepend">
        <label for="UnitName" class="np_label">Полное наименование</label>
        <input type="text" id="UnitName" name="UnitName" placeholder="Полное наименование" value="@Model.UnitName" @if (Model.LoginID == 0) { @atr_disabled } />
    </div>
    <div class="input-prepend">
        <div class="input-prepend">
            <button type="button" id="btnSelectGroup" class="add-on openDialog" href="/UnitCategory/SelectUnitCategoryList" np_dialog_title="Выбор группы" @if (Model.LoginID == 0) { @atr_disabled }>Группа</button>
            <input type="text" readonly id="UnitGroupShortName" name="UnitGroupShortName" size="24" value="@Model.UnitGroupShortName" @if (Model.LoginID == 0) { @atr_disabled } data-target="UnitGroupShortName" data-target-value=""/>
        </div>

        @*<select id="UnitGroupID" name="UnitGroupID">
                @foreach (var item in @ViewBag.UnitGroups)
                {
                    <option value="@item.UnitGroupID" selected="@if (item.UnitGroupID == Model.UnitGroupID) { @atr_selected }"> @item.UnitGroupShortName</option>
                }
            </select>*@
    </div>
    @if (Model.LoginID != 0)
    {
        <div class="form-group">
            <input type="submit" value="Save" class="btn btn-default" />
        </div>
    }
</form>
<script type="text/javascript">
    $(function () {
        $('#btnSelectGroup').on('click', function (e) {
            e.preventDefault();
            OpenDialog(this, null, true);
        });
        // отрабатываем событие изменения атрибута при выборе из диалога
        $("#UnitGroupID").on("targetValueChanged", function (e) {
            e.preventDefault();
            $(this).val($(this).attr("data-target-value")); // присваиваем значение атрибута
        });
        $("#UnitGroupShortName").on("targetValueChanged", function (e) {
            e.preventDefault();
            $(this).val($(this).attr("data-target-value")); // присваиваем значение атрибута
        });

        // submit
        var adata = new Object();
        adata.onSuccess = function () {
            location.reload();
        }
        $("#unit").bind('submit', adata, np_AjaxFormSubmit);
        // очистка сообщений об ошибках по клику 
        $("#unit").bind('click', np_AjaxFormInputClick); 
        $("#unit")
            .validate({
                rules: {
                    UnitShortName: {
                        required: true,
                        maxlength: 16
                    },
                    UnitName: {
                        required: true,
                        maxlength: 32
                    },
                    UnitGroupShortName: {
                        required: true
                    }
                },
                messages: {
                    UnitShortName: {
                        required: "Обязательно для заполнения",
                    },
                    UnitName: {
                        required: "Обязательно для заполнения",
                    },
                    UnitGroupShortName: {
                        required: "Обязательно для выбора"
                    }
                }
            });


    });
</script>